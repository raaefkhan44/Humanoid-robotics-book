# Data Model: RAG Chatbot for Docusaurus Book

## Entity: Question
**Description**: A user query submitted to the RAG system
**Fields**:
- `id`: Unique identifier (UUID/string)
- `content`: The text of the user's question (string, required)
- `timestamp`: When the question was submitted (datetime, required)
- `session_id`: Identifier for the conversation session (string, optional)
- `source_mode`: How the question was submitted ('full' for full-book RAG, 'selected' for selected-text QA) (string, required)

## Entity: Book Content Chunk
**Description**: Processed segment of book content with metadata
**Fields**:
- `id`: Unique identifier (UUID/string)
- `content`: The text content of the chunk (string, required)
- `embedding`: Vector representation of the content (array/float, required)
- `file_path`: Path to the source markdown file (string, required)
- `section`: Section title where this chunk appears (string, optional)
- `chapter`: Chapter name/number (string, optional)
- `chunk_index`: Position of this chunk within the document (integer, required)
- `metadata`: Additional metadata (object, optional)

## Entity: Retrieved Context
**Description**: A set of relevant text chunks retrieved from the vector database
**Fields**:
- `question_id`: Reference to the original question (string, required)
- `chunks`: Array of relevant content chunks (array of Book Content Chunk references, required)
- `relevance_scores`: Similarity scores for each chunk (array of floats, required)
- `retrieval_timestamp`: When the retrieval was performed (datetime, required)

## Entity: Answer
**Description**: A response generated by the OpenAI agent based on retrieved context
**Fields**:
- `id`: Unique identifier (UUID/string)
- `question_id`: Reference to the original question (string, required)
- `content`: The text content of the answer (string, required)
- `timestamp`: When the answer was generated (datetime, required)
- `session_id`: Identifier for the conversation session (string, optional)
- `source_chunks`: References to the chunks that informed the answer (array of chunk IDs, optional)
- `confidence_score`: Agent's confidence in the answer (float, optional)

## Entity: Log Entry
**Description**: Record of user interaction including question, response, and metadata
**Fields**:
- `id`: Unique identifier (UUID/string)
- `question_id`: Reference to the question (string, required)
- `answer_id`: Reference to the answer (string, required)
- `user_session`: User session identifier (string, optional)
- `mode`: Operation mode ('full' or 'selected') (string, required)
- `timestamp`: When the interaction occurred (datetime, required)
- `user_feedback`: Optional user feedback on the answer quality (string, optional)

## Entity: Embedding Job
**Description**: Record of embedding generation jobs
**Fields**:
- `id`: Unique identifier (UUID/string)
- `status`: Current status of the job ('pending', 'processing', 'completed', 'failed') (string, required)
- `total_files`: Number of files to process (integer, required)
- `processed_files`: Number of files processed (integer, required)
- `total_embeddings`: Total number of embeddings generated (integer, required)
- `start_time`: When the job started (datetime, required)
- `end_time`: When the job completed (datetime, optional)
- `error_message`: Error details if job failed (string, optional)

## Relationships

- Question → 0..1 Answer (one-to-one, optional on Answer)
- Question → 1..* Retrieved Context (one-to-many)
- Retrieved Context → 1..* Book Content Chunk (one-to-many)
- Answer → 1 Log Entry (one-to-one)
- Log Entry → 1 Question (one-to-one)
- Log Entry → 1 Answer (one-to-one)

## Validation Rules

- Question content must be between 5 and 1000 characters
- Book Content Chunk content must be between 50 and 2000 characters
- Embedding vectors must match the expected dimension for the chosen model
- Timestamps must be in valid datetime format
- File paths must be valid relative paths within the book content directory
- Session IDs must follow the format /[a-zA-Z0-9-_]+/
- Source mode must be either 'full' or 'selected'

## State Transitions (for Embedding Job)

- `pending` → `processing` (when job starts)
- `processing` → `completed` (when all files processed successfully)
- `processing` → `failed` (when error occurs during processing)
- `pending` → `failed` (when validation fails before processing)